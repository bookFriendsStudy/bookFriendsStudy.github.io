---
layout: post
title: 6. Command Pattern
date: 2023-03-26 21:00:00 +0900
categories: 
- Headfirst Design Pattern
author: hojunee
---
# 6. Command Pattern

## TL;DR

- ìš”ì²­ì„ ë…ë¦½ì ì¸ **ê°ì²´**ë¡œ ìº¡ìŠí™”í•˜ëŠ” ë””ìì¸ íŒ¨í„´

### Start from scratch

- ë¦¬ëª¨ì½˜ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ?
- ì‚¬ìš©í•´ì•¼í•˜ëŠ” í´ë˜ìŠ¤ê°€ ë§ìœ¼ë©´ì„œë„, **ê³µí†µì ì¸ ì¸í„°í˜ì´ìŠ¤ê°€ ë³´ì´ì§€ ì•ŠìŒ**
- ì´ëŸ¬í•œ í´ë˜ìŠ¤ê°€ ì¶”ê°€ë˜ê±°ë‚˜ ì‚­ì œë  ê°€ëŠ¥ì„±ì„ ì—´ì–´ë‘ì–´ì•¼í•¨

### Logic

- **Sender**(a.k.a Invoker)
    - ìš”ì²­ì„ ë³´ë‚´ëŠ” ê°ì²´
    - ìš”ì²­ì„ ìº¡ìŠí™”í•œ Command ê°ì²´ë¥¼ ìƒì„±í•˜ê³ , ì´ë¥¼ ì‹¤í–‰í•˜ëŠ” execute() ë©”ì„œë“œë¥¼ í˜¸ì¶œ
    
    ```java
    public class SimpleRemoteControl {
    	Command slot;
     
    	public SimpleRemoteControl() {}
     
    	public void setCommand(Command command) {
    		slot = command;
    	}
     
    	public void buttonWasPressed() {
    		slot.execute();
    	}
    }
    ```

- *Command* *`<<Inteface>>`*
    - `execute()` - ì‹¤í–‰í•˜ê³ ì í•˜ëŠ” ë‹¨ìˆœ ë©”ì„œë“œ
    
    ```java
    public interface Command {
    	public void execute();
    }
    ```
    
    ì´ë¥¼ êµ¬í˜„í•˜ë©´? ğŸ‘‡ğŸ¼
    
    ```
    public class LightOnCommand implements Command {
    	Light light; /* TODO: Implement this! */
      
      // Point out the target light by init
    	public LightOnCommand(Light light) {
    		this.light = light;
    	}
     
    	public void execute() {
    		light.on();
    	}
    }
    ```
    

- **Receiver**
    - ìš”ì²­ì„ ë°›ì•„ë“¤ì´ê³ , ì´ì— ëŒ€í•œ ë™ì‘ì„ ìˆ˜í–‰í•˜ëŠ” ê°ì²´
    
    ```java
    public class Light {
    
    	public Light() {
    	}
    
    	public void on() {
    		System.out.println("Light is on");
    	}
    
    	public void off() {
    		System.out.println("Light is off");
    	}
    }
    ```
    

- **Client**
    
    ```java
    // Work as Client
    public class RemoteControlTest {
    	public static void main(String[] args) {
    		// `remote` works as Invoker
    		SimpleRemoteControl remote = new SimpleRemoteControl();
    
    		// Initialize `light` Receiver
    		Light light = new Light();
    
    		LightOnCommand lightOn = new LightOnCommand(light);
     
    		// Command -> Invoker
    		remote.setCommand(lightOn);
    
    		// Event Triggered!
    		remote.buttonWasPressed();
        }
    }
    ```
    

### Implementation I

- ë¦¬ëª¨ì½˜ì„ êµ¬í˜„í•˜ë©´?

```java
public class RemoteControl {
	Command[] onCommands;
	Command[] offCommands;
 
	public RemoteControl() {
		/* ë²„íŠ¼ì´ 7ê°œì´ë¯€ë¡œ onê³¼ offì— 7ê°œë¥¼ êµ¬í˜„ */
		onCommands = new Command[7];
		offCommands = new Command[7];
 
		/* ë¦¬ë¹™í¬ì¸íŠ¸: NoCommandë¥¼ ì´ìš©í•œ null guard */
		Command noCommand = new NoCommand();
		for (int i = 0; i < 7; i++) {
			onCommands[i] = noCommand;
			offCommands[i] = noCommand;
		}
	}
  
	/* íŠ¹ì • ìŠ¬ë¡¯ì— Command í• ë‹¹ */
	public void setCommand(int slot, Command onCommand, Command offCommand) {
		onCommands[slot] = onCommand;
		offCommands[slot] = offCommand;
	}

	/* ê° Button Eventê°€ ë°œìƒí•˜ë©´ `execute()` ì‹¤í–‰ */
	public void onButtonWasPushed(int slot) {
		onCommands[slot].execute();
	}
 
	public void offButtonWasPushed(int slot) {
		offCommands[slot].execute();
	}
}
```

cf) `NoCommand`?

```java
public class NoCommand implements Command {
	public void execute() { }
}
```

---

### Client I

- ë‘ê°œì˜ ë²„íŠ¼ìœ¼ë¡œ livingRoomê³¼ kitchenì˜ ì „êµ¬ë¥¼ ê´€ë¦¬í•œë‹¤ë©´?

```java
public class RemoteLoader {
 
	public static void main(String[] args) {
		RemoteControl remoteControl = new RemoteControl();
 
		Light livingRoomLight = new Light("Living Room");
		Light kitchenLight = new Light("Kitchen");
  
		LightOnCommand livingRoomLightOn = 
				new LightOnCommand(livingRoomLight);
		LightOffCommand livingRoomLightOff = 
				new LightOffCommand(livingRoomLight);
		LightOnCommand kitchenLightOn = 
				new LightOnCommand(kitchenLight);
		LightOffCommand kitchenLightOff = 
				new LightOffCommand(kitchenLight);
 
		remoteControl.setCommand(0, livingRoomLightOn, livingRoomLightOff);
		remoteControl.setCommand(1, kitchenLightOn, kitchenLightOff);
 
		remoteControl.onButtonWasPushed(0);
		remoteControl.offButtonWasPushed(0);
		remoteControl.onButtonWasPushed(1);
		remoteControl.offButtonWasPushed(1);
	}
}
```

## Add-On I - Undo

- ì‘ì—… ì·¨ì†Œ ê¸°ëŠ¥ì„ ì–´ë–»ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆì„ê¹Œ?
- ì–´ë””ì— ì¶”ê°€í•´ì•¼í• ê¹Œ? â†’ **Command**!
    
    ```java
    public interface Command {
    	public void execute();
    	public void undo(); // NEW!
    }
    ```
    

- ì´ë¥¼ êµ¬í˜„í•˜ëŠ” **Lightâ€¦Command**ì— undo ë‚´ìš©ì„ êµ¬í˜„
    
    ```java
    public class LightOnCommand implements Command {
    	Light light;
    
    	public LightOnCommand(Light light) {
    		this.light = light;
    	}
     
    	public void execute() {
    		light.on()
    	}
     
      /* `execute()`ì˜ í–‰ë™ê³¼ ë°˜ëŒ€ë¡œ ì§„í–‰ */
    	public void undo() {
    		light.off();
    	}
    }
    ```
    

- ì´ì— ë”°ë¼ Invokerë„ ìˆ˜ì •í•˜ë©´:
    
    ```java
    public class RemoteControlWithUndo {
    	Command[] onCommands;
    	Command[] offCommands;
    	Command undoCommand; // Saves the last command
     
    	public RemoteControlWithUndo() {
    		onCommands = new Command[7];
    		offCommands = new Command[7];
     
    		Command noCommand = new NoCommand();
    		for(int i=0;i<7;i++) {
    			onCommands[i] = noCommand;
    			offCommands[i] = noCommand;
    		}
    		undoCommand = noCommand;
    	}
    
    	public void onButtonWasPushed(int slot) {
    		onCommands[slot].execute();
    		undoCommand = onCommands[slot];
    	}
    	 
    	public void offButtonWasPushed(int slot) {
    		offCommands[slot].execute();
    		undoCommand = offCommands[slot];
    	}
     
    	public void undoButtonWasPushed() {
    		undoCommand.undo();
    	}
    }
    ```
    

## Add-On II - Multitasking

- í•œ ë²„íŠ¼ì— ì—¬ëŸ¬ ê¸°ëŠ¥ì„ íƒ‘ì¬í•˜ë ¤ë©´?
- `MacroCommand`ë¥¼ ë§Œë“¤ì!
    - MacroCommandëŠ” ì—¬ëŸ¬ Commandë¥¼ ì†Œìœ 
    - `execute()` í˜¸ì¶œ ì‹œ ê° commandì˜ `execute()`ë¥¼ í˜¸ì¶œ
    - `undo()` í˜¸ì¶œ ì‹œ ê° commandì˜ `undo()`ë¥¼ í˜¸ì¶œ
    
    ```java
    public class MacroCommand implements Command {
    	Command[] commands;
     
    	public MacroCommand(Command[] commands) {
    		this.commands = commands;
    	}
     
    	public void execute() {
    		for (int i = 0; i < commands.length; i++) {
    			commands[i].execute();
    		}
    	}
     
    	public void undo() {
    		for (int i = commands.length - 1; i >= 0; i--) {
    			commands[i].undo();
    		}
    	}
    }
    ```
    
# Insights âœ¨

> Senderì™€ Receiver ì‚¬ì´ì˜ **ê²°í•©ë„ë¥¼ ë‚®ì¶”ì–´**, 
ìš”ì²­ì„ ë³´ë‚´ëŠ” ê°ì²´ì™€ ìš”ì²­ì„ ë°›ì•„ ì²˜ë¦¬í•˜ëŠ” ê°ì²´ë¥¼ ë¶„ë¦¬í•  ìˆ˜ ìˆìŒ

> Queueë‚˜ Stack ë“±ì˜ ìë£Œêµ¬ì¡°ë¥¼ í™œìš©í•˜ì—¬ ìš”ì²­ì˜ ì§€ì—° ì‹¤í–‰, Undo ë“±ì˜ ê¸°ëŠ¥ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŒ