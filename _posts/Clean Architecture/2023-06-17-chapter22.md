---
layout: post
title: 22. 클린 아키텍처
date: 2023-06-17 21:00:00 +0900
categories:
- Clean Architecture
author: jjonyo
---

# 22장 : 클린 아키텍처

지난 수십년간 여러가지 아키텍처 아이디어가 등장했다.

아키텍처들은 모두 세부적인 면에서  차이는 있지만 이들의 목표는 모두 `관심사의 분리` 이다.

아키텍처는 시스템이 다음과 같은 특정을 지니도록 만든다.

- 프레임워크 독립성
- 테스트 용이성
- UI 독립성
- 데이터베이스 독립성
- 모든 외부 에이전시에 대한 독립성

## 의존성 규칙


- 안으로 들어갈수록 고수준의 소프트웨어가 된다.
- 바깥쪽 원은 메커니즘, 안쪽 원은 정책이다.
- 이런 아키텍처가 동작하도록 하는 가장 중요한 규칙은 `의존성 규칙` 이다.

- 내부에 속한 요소는 외부에 속한 어떤것도 알지 못해야 한다.

### 엔티티

- 전사적인 핵심 업무 규칙을 캡슐화 한다.
- 메소드를 가지거나, 일련의 데이터 구조와 함수의 집합이다.
- 가장 일반적이며 고수준인 규칙을 캡슐화하여, 외부의 변화에 변경될 가능성이 지극히 낮다.

### 유스케이스

- 애플리케이션에 특화된 업무 규칙을 포함한다.
- 엔티티로 들어오고 나가는 데이터 흐름을 조정하며 엔티티가 자신의 업무 규칙을 적용하여 유스케이스의 목적을 달성하도록 한다.
- 유스케이스 계층에서 발생한 변경이 엔티티에 영향을 줘서는 안된다.
- 또한, UI, DB등 외부 요소의 변경이 유스케이스에 영향을 줘서도 안된다.

### 인터페이스 어댑터

- 데이터를 유스케이스와 엔티티에게 편리한 형식에서 → 외부 에이전시에게 가장 편리한 형식으로 변환한다.
- ex. 프레젠터, 뷰, 컨트롤러
- 이때, 모델이라는 단순한 데이터 구조를 지닌 요소를 통해 컨트롤러에서 유스케이스로 전달한다.

### 프레임워크, 드라이버

- 가장 바깥쪽 구성요소이다.
- 안쪽과 통신해야 하는 코드 외에는 작성해야 할 코드가 그다지 많지 않다.
- 데이터베이스, 프레임워크 등 세부사항을 외부에 위치시켜 피해를 최소화 한다.

### 경계 횡단하기

- 제어흐름과 의존성이 방향이 같아야 한다. (컨트롤러 → 유스케이스 → 엔티티)
- 제어흐름과 의존성 방향이 반대여야 하는 경우 의존성 역전 원칙을 사용하여 해결한다.
- 각각의 경계를 횡단할때는 간단한 데이터 전송객체(DTO)를 사용한다.
- 경계를 가로질러 데이터를 전달할때는 항상 내부의 원에서 사용하기 가장 편리한 형태를 가져야 한다.

## 전형적인 시나리오


웹 기반 자바 시스템의 예시

- 웹서버는 사용자의 입력 데이터를 모아 `컨트롤러` 로 전달한다.
- 컨트롤러는 데이터를 객체(POJO)로 묶은후 InputBoundary 인터페이스를 통해 `유스케이스` 로 전달한다.
- `유스케이스` 는 데이터를 해석하여 `엔티티`를 목표에 맞게 제어한다.
- `DataAccessInterface` 는 엔티티가 사용할 데이터를 DB에서 불러와 메모리에 로드한다.
- 엔티티가 완성되면 유스케이스는 엔티티로부터 데이터를 모아 다시 POJO output data를 만든다.
- 그리고 이 OutputData는 인터페이스를 통해 프레젠터로 전달되고, 뷰 모델을 만들어 뷰에서 화면을 출력하게 된다.

## 결론

- 위 규칙들을 적용하면 향후에 겪을 수많은 고통거리를 덜어줄 것이다.
- 소프트웨어를 계층으로 분리하고, 의존성 규칙을 준수한다면 테스트하기 쉬운 시스템을 만들 수 있다.

- 계층간의 경계에 대해 더 자세히 알게된 것 같다.
- (저는) 프레임워크를 통해 아키텍처를 배웠는데 프레임워크가 왜 그런 아키텍처를 가지게 되었는지 이해할 수 있었다.
- 그리고, 실무에서는 이 모든 원칙을 지키는 것이 힘드니 일정부분 타협하는 지점도 찾을 수 있었다. (ex. entity를 usecase계층에서 사용한다든지..)